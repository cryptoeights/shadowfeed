<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <title>ShadowFeed — AI Data Marketplace</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
          colors: {
            brand: { 50: '#fff7ed', 100: '#ffedd5', 200: '#fed7aa', 300: '#fdba74', 400: '#f97316', 500: '#f7931a', 600: '#ea580c', 700: '#c2410c' },
          }
        }
      }
    }
  </script>
  <style>
    * { scroll-behavior: smooth; }
    body { background: #fafafa; overflow-x: hidden; }

    /* ===== 3D PARTICLE CANVAS ===== */
    #particle-canvas {
      position: absolute;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }

    /* Soft gradient overlay behind hero text */
    .hero-bg {
      position: absolute;
      inset: 0;
      overflow: hidden;
      z-index: 1;
    }
    .hero-bg::before {
      content: '';
      position: absolute;
      width: 200%;
      height: 200%;
      top: -50%;
      left: -50%;
      background:
        radial-gradient(ellipse 600px 600px at 20% 30%, rgba(247,147,26,0.08), transparent),
        radial-gradient(ellipse 500px 500px at 70% 60%, rgba(168,85,247,0.06), transparent),
        radial-gradient(ellipse 700px 700px at 50% 20%, rgba(59,130,246,0.05), transparent);
      animation: meshMove 20s ease-in-out infinite;
    }
    @keyframes meshMove {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(30px, -30px) rotate(1deg); }
      66% { transform: translate(-20px, 20px) rotate(-1deg); }
    }

    /* Grid pattern overlay */
    .grid-pattern {
      position: absolute;
      inset: 0;
      background-image: linear-gradient(rgba(0,0,0,0.02) 1px, transparent 1px),
                         linear-gradient(90deg, rgba(0,0,0,0.02) 1px, transparent 1px);
      background-size: 60px 60px;
      z-index: 2;
    }

    .gradient-text { background: linear-gradient(135deg, #f7931a 0%, #ea580c 50%, #f97316 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .gradient-text-purple { background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

    .card { background: white; border: 1px solid #e5e7eb; border-radius: 16px; transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
    .card:hover { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.08); border-color: #d1d5db; transform: translateY(-4px); }

    .card-dark { background: #18181b; border: 1px solid #27272a; border-radius: 16px; }

    .pulse-dot { animation: pulse 2s ease-in-out infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

    .fade-in { animation: fadeIn 0.6s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    .slide-up { animation: slideUp 0.4s ease-out; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* ===== SCROLL REVEAL ANIMATIONS ===== */
    .reveal {
      opacity: 0;
      transform: translateY(40px);
      transition: opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .reveal-left {
      opacity: 0;
      transform: translateX(-40px);
      transition: opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .reveal-left.visible {
      opacity: 1;
      transform: translateX(0);
    }
    .reveal-right {
      opacity: 0;
      transform: translateX(40px);
      transition: opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .reveal-right.visible {
      opacity: 1;
      transform: translateX(0);
    }
    .reveal-scale {
      opacity: 0;
      transform: scale(0.92);
      transition: opacity 0.7s ease, transform 0.7s ease;
    }
    .reveal-scale.visible {
      opacity: 1;
      transform: scale(1);
    }
    .stagger-1 { transition-delay: 0.1s; }
    .stagger-2 { transition-delay: 0.2s; }
    .stagger-3 { transition-delay: 0.3s; }
    .stagger-4 { transition-delay: 0.4s; }

    /* ===== HERO ENTRANCE ===== */
    .hero-enter { animation: heroEnter 1.2s cubic-bezier(0.16, 1, 0.3, 1) both; }
    .hero-enter-delay-1 { animation: heroEnter 1.2s cubic-bezier(0.16, 1, 0.3, 1) 0.15s both; }
    .hero-enter-delay-2 { animation: heroEnter 1.2s cubic-bezier(0.16, 1, 0.3, 1) 0.3s both; }
    .hero-enter-delay-3 { animation: heroEnter 1.2s cubic-bezier(0.16, 1, 0.3, 1) 0.5s both; }
    .hero-enter-delay-4 { animation: heroEnter 1.2s cubic-bezier(0.16, 1, 0.3, 1) 0.7s both; }
    @keyframes heroEnter {
      from { opacity: 0; transform: translateY(30px) scale(0.97); filter: blur(4px); }
      to { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
    }

    /* ===== SMOOTH NAV ===== */
    nav { transition: background 0.3s, box-shadow 0.3s, border-color 0.3s; }
    nav.scrolled { background: rgba(255,255,255,0.95); box-shadow: 0 1px 20px rgba(0,0,0,0.06); }

    pre::-webkit-scrollbar { height: 6px; }
    pre::-webkit-scrollbar-track { background: #f4f4f5; border-radius: 3px; }
    pre::-webkit-scrollbar-thumb { background: #d4d4d8; border-radius: 3px; }

    .step-line { position: absolute; left: 19px; top: 40px; bottom: -8px; width: 2px; background: linear-gradient(to bottom, #f7931a, transparent); }

    /* Section divider */
    .section-divider { height: 1px; background: linear-gradient(90deg, transparent, #e5e7eb 20%, #e5e7eb 80%, transparent); }

    /* Stat counter animation */
    .stat-card { background: white; border-radius: 16px; border: 1px solid #f4f4f5; box-shadow: 0 1px 3px rgba(0,0,0,0.04); transition: all 0.3s ease; }
    .stat-card:hover { box-shadow: 0 8px 25px rgba(0,0,0,0.06); transform: translateY(-2px); }

    /* Smooth number counter */
    @keyframes countUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    .count-animate { animation: countUp 0.4s ease-out; }

    /* Glow effect on CTA */
    .cta-glow {
      position: relative;
      overflow: hidden;
    }
    .cta-glow::after {
      content: '';
      position: absolute;
      inset: -2px;
      background: linear-gradient(135deg, rgba(247,147,26,0.3), rgba(234,88,12,0.3));
      border-radius: inherit;
      z-index: -1;
      filter: blur(12px);
      opacity: 0;
      transition: opacity 0.4s;
    }
    .cta-glow:hover::after { opacity: 1; }
  </style>
</head>
<body class="font-sans text-gray-700 antialiased">

  <!-- Nav -->
  <nav class="fixed top-0 w-full z-50 bg-white/80 backdrop-blur-xl border-b border-gray-100">
    <div class="max-w-6xl mx-auto px-6 h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-orange-500 to-amber-500 flex items-center justify-center shadow-lg shadow-orange-500/20">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
        </div>
        <span class="font-extrabold text-gray-900 text-lg tracking-tight">Shadow<span class="text-orange-500">Feed</span></span>
      </div>
      <div class="flex items-center gap-6">
        <a href="#feeds" class="text-sm text-gray-500 hover:text-gray-900 transition font-medium">Feeds</a>
        <a href="#how-it-works" class="text-sm text-gray-500 hover:text-gray-900 transition font-medium">How It Works</a>
        <a href="#try-it" class="text-sm text-gray-500 hover:text-gray-900 transition font-medium">Try It</a>
        <a href="#activity" class="text-sm text-gray-500 hover:text-gray-900 transition font-medium">Activity</a>
        <a href="#leaderboard" class="text-sm text-gray-500 hover:text-gray-900 transition font-medium">Leaderboard</a>
        <div class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-emerald-50 border border-emerald-200">
          <div class="w-2 h-2 rounded-full bg-emerald-500 pulse-dot"></div>
          <span class="text-xs text-emerald-600 font-semibold" id="network-badge">Testnet</span>
        </div>
        <button id="wallet-btn" onclick="connectWallet()" class="flex items-center gap-2 px-5 py-2 rounded-xl bg-gray-900 hover:bg-gray-800 text-white text-sm font-semibold transition shadow-lg shadow-gray-900/10">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
          <span id="wallet-btn-text">Connect Wallet</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <section class="relative pt-32 pb-24 px-6 overflow-hidden min-h-[90vh] flex items-center" id="hero">
    <canvas id="particle-canvas"></canvas>
    <div class="hero-bg"></div>
    <div class="grid-pattern"></div>

    <div class="max-w-5xl mx-auto text-center relative z-10">
      <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/80 backdrop-blur-sm border border-gray-200 shadow-sm mb-8 hero-enter">
        <div class="w-2 h-2 rounded-full bg-orange-500 pulse-dot"></div>
        <span class="text-sm text-gray-600 font-medium">Powered by x402 Protocol on Stacks (Bitcoin L2)</span>
      </div>
      <h1 class="text-6xl md:text-7xl lg:text-8xl font-black text-gray-900 leading-[0.95] mb-8 tracking-tight hero-enter-delay-1">
        Data Marketplace<br>for <span class="gradient-text">AI Agents</span>
      </h1>
      <p class="text-xl md:text-2xl text-gray-500 max-w-2xl mx-auto mb-12 leading-relaxed font-light hero-enter-delay-2">
        AI agents buy real-time crypto intelligence autonomously. Pay per-query with STX. No signup. No subscription. Settled on Bitcoin.
      </p>
      <div class="flex flex-wrap justify-center gap-4 mb-20 hero-enter-delay-3">
        <a href="#try-it" class="cta-glow px-8 py-4 bg-gray-900 hover:bg-gray-800 text-white font-semibold rounded-2xl transition-all duration-300 shadow-xl shadow-gray-900/10 text-lg hover:shadow-2xl hover:scale-[1.02]">
          Try the API
        </a>
        <a href="#how-it-works" class="px-8 py-4 bg-white/80 backdrop-blur-sm hover:bg-white text-gray-700 font-semibold rounded-2xl border border-gray-200 transition-all duration-300 shadow-sm text-lg hover:shadow-lg hover:scale-[1.02]">
          How It Works
        </a>
      </div>

      <!-- Stats bar -->
      <div class="flex justify-center gap-12 hero-enter-delay-4">
        <div class="text-center">
          <div class="text-4xl font-black text-gray-900" id="hero-feeds">3</div>
          <div class="text-sm text-gray-400 font-medium mt-1">Live Feeds</div>
        </div>
        <div class="w-px bg-gray-200"></div>
        <div class="text-center">
          <div class="text-4xl font-black text-gray-900" id="hero-queries">0</div>
          <div class="text-sm text-gray-400 font-medium mt-1">Queries Served</div>
        </div>
        <div class="w-px bg-gray-200"></div>
        <div class="text-center">
          <div class="text-4xl font-black text-orange-500">$0.003</div>
          <div class="text-sm text-gray-400 font-medium mt-1">Starting Price</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Problem/Solution -->
  <section class="py-24 px-6">
    <div class="max-w-5xl mx-auto">
      <div class="text-center mb-16 reveal">
        <p class="text-sm font-semibold text-orange-500 uppercase tracking-widest mb-3">The Problem</p>
        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">Why ShadowFeed?</h2>
        <p class="text-lg text-gray-400 max-w-2xl mx-auto">AI agents need data but can't access traditional providers.</p>
      </div>
      <div class="grid md:grid-cols-3 gap-6">
        <div class="card p-8 reveal stagger-1">
          <div class="w-14 h-14 rounded-2xl bg-red-50 flex items-center justify-center mb-5">
            <svg class="w-7 h-7 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          </div>
          <h3 class="text-lg font-bold text-gray-900 mb-2">Expensive Subscriptions</h3>
          <p class="text-sm text-gray-500 leading-relaxed">CoinGecko $129/mo, Nansen $2,500/mo — AI agents only need a few queries. Monthly subscriptions are wasteful.</p>
        </div>
        <div class="card p-8 reveal stagger-2">
          <div class="w-14 h-14 rounded-2xl bg-amber-50 flex items-center justify-center mb-5">
            <svg class="w-7 h-7 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
          </div>
          <h3 class="text-lg font-bold text-gray-900 mb-2">Agents Can't Sign Up</h3>
          <p class="text-sm text-gray-500 leading-relaxed">AI agents have no identity, can't create accounts, and don't have credit cards. They need autonomous payment.</p>
        </div>
        <div class="card p-8 border-orange-200 bg-orange-50/30 reveal stagger-3">
          <div class="w-14 h-14 rounded-2xl bg-orange-100 flex items-center justify-center mb-5">
            <svg class="w-7 h-7 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
          </div>
          <h3 class="text-lg font-bold text-gray-900 mb-2">Pay-Per-Query via x402</h3>
          <p class="text-sm text-gray-500 leading-relaxed">Agent hits endpoint, auto-pays via STX micropayment, data delivered instantly. No signup, no subscription needed.</p>
        </div>
      </div>
    </div>
  </section>

  <div class="section-divider"></div>

  <!-- Feeds -->
  <section id="feeds" class="py-24 px-6">
    <div class="max-w-5xl mx-auto">
      <div class="text-center mb-16 reveal">
        <p class="text-sm font-semibold text-orange-500 uppercase tracking-widest mb-3">Marketplace</p>
        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">Available Data Feeds</h2>
        <p class="text-lg text-gray-400">Real-time crypto intelligence — pay only when you need it.</p>
      </div>
      <div class="grid md:grid-cols-3 gap-6 reveal" id="feeds-grid"></div>
    </div>
  </section>

  <div class="section-divider"></div>

  <!-- How It Works -->
  <section id="how-it-works" class="py-24 px-6 bg-gray-50/50">
    <div class="max-w-4xl mx-auto">
      <div class="text-center mb-16 reveal">
        <p class="text-sm font-semibold text-orange-500 uppercase tracking-widest mb-3">Protocol</p>
        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">How It Works</h2>
        <p class="text-lg text-gray-400">4 steps. Fully autonomous. No human needed.</p>
      </div>
      <div class="space-y-8">
        <div class="flex gap-6 relative reveal-left stagger-1">
          <div class="flex-shrink-0 w-10 h-10 rounded-full bg-orange-100 border-2 border-orange-400 flex items-center justify-center text-orange-600 font-bold text-sm z-10">1</div>
          <div class="step-line"></div>
          <div class="pb-4">
            <h3 class="text-lg font-bold text-gray-900 mb-2">Discover — Agent Finds Feeds</h3>
            <p class="text-sm text-gray-500 mb-3">Agent accesses <code class="px-2 py-0.5 bg-gray-100 rounded text-orange-600 text-xs font-mono">/registry/feeds</code> to browse available data feeds and pricing. <strong class="text-emerald-600">Free!</strong></p>
            <div class="card-dark p-4 font-mono text-sm">
              <span class="text-emerald-400">GET</span> <span class="text-blue-400">/registry/feeds</span> <span class="text-zinc-500">// List all feeds + prices</span>
            </div>
          </div>
        </div>
        <div class="flex gap-6 relative reveal-left stagger-2">
          <div class="flex-shrink-0 w-10 h-10 rounded-full bg-orange-100 border-2 border-orange-400 flex items-center justify-center text-orange-600 font-bold text-sm z-10">2</div>
          <div class="step-line"></div>
          <div class="pb-4">
            <h3 class="text-lg font-bold text-gray-900 mb-2">Request — Server Returns 402</h3>
            <p class="text-sm text-gray-500 mb-3">Agent requests data. Server responds with <code class="px-2 py-0.5 bg-amber-50 rounded text-amber-700 text-xs font-bold font-mono">HTTP 402 Payment Required</code> — containing payment details.</p>
            <div class="card-dark p-4 font-mono text-sm">
              <span class="text-emerald-400">GET</span> <span class="text-blue-400">/feeds/whale-alerts</span><br>
              <span class="text-yellow-400">← 402</span> <span class="text-zinc-500">{ amount: "0.005 STX", payTo: "ST3G55..." }</span>
            </div>
          </div>
        </div>
        <div class="flex gap-6 relative reveal-left stagger-3">
          <div class="flex-shrink-0 w-10 h-10 rounded-full bg-orange-100 border-2 border-orange-400 flex items-center justify-center text-orange-600 font-bold text-sm z-10">3</div>
          <div class="step-line"></div>
          <div class="pb-4">
            <h3 class="text-lg font-bold text-gray-900 mb-2">Pay — Agent Auto-Signs TX</h3>
            <p class="text-sm text-gray-500 mb-3">x402 SDK signs an STX transaction from the agent's wallet and re-sends the request with payment proof. <strong class="text-gray-900">Fully autonomous!</strong></p>
            <div class="card-dark p-4 font-mono text-sm">
              <span class="text-emerald-400">GET</span> <span class="text-blue-400">/feeds/whale-alerts</span><br>
              <span class="text-zinc-500">Header:</span> <span class="text-purple-400">payment-signature: [signed-tx]</span>
            </div>
          </div>
        </div>
        <div class="flex gap-6 reveal-left stagger-4">
          <div class="flex-shrink-0 w-10 h-10 rounded-full bg-emerald-100 border-2 border-emerald-400 flex items-center justify-center text-emerald-600 font-bold text-sm z-10">4</div>
          <div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">Receive — Data Delivered</h3>
            <p class="text-sm text-gray-500 mb-3">Payment verified and settled on Stacks (Bitcoin L2). Data returned instantly. Everything provable on-chain.</p>
            <div class="card-dark p-4 font-mono text-sm">
              <span class="text-emerald-400">← 200 OK</span> <span class="text-zinc-500">+ whale alert data + tx receipt</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="section-divider"></div>

  <!-- Try It -->
  <section id="try-it" class="py-24 px-6">
    <div class="max-w-5xl mx-auto">
      <div class="text-center mb-16 reveal">
        <p class="text-sm font-semibold text-orange-500 uppercase tracking-widest mb-3">Interactive</p>
        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">Try It Live</h2>
        <p class="text-lg text-gray-400">Click an endpoint to see the API response in real-time.</p>
      </div>
      <div class="grid md:grid-cols-2 gap-8 reveal-scale">
        <div>
          <h3 class="text-sm font-bold text-emerald-600 uppercase tracking-wider mb-4 flex items-center gap-2">
            <div class="w-2 h-2 rounded-full bg-emerald-500"></div> Free Endpoints
          </h3>
          <div class="space-y-3">
            <button onclick="tryEndpoint('/registry/feeds')" class="w-full text-left p-4 card group">
              <div class="flex items-center justify-between mb-1">
                <div class="font-mono text-sm"><span class="text-emerald-600">GET</span> <span class="text-gray-900 font-semibold">/registry/feeds</span></div>
                <svg class="w-4 h-4 text-gray-300 group-hover:text-orange-500 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
              </div>
              <p class="text-xs text-gray-400">View all available data feeds</p>
            </button>
            <button onclick="tryEndpoint('/stats')" class="w-full text-left p-4 card group">
              <div class="flex items-center justify-between mb-1">
                <div class="font-mono text-sm"><span class="text-emerald-600">GET</span> <span class="text-gray-900 font-semibold">/stats</span></div>
                <svg class="w-4 h-4 text-gray-300 group-hover:text-orange-500 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
              </div>
              <p class="text-xs text-gray-400">Provider statistics and reputation</p>
            </button>
            <button onclick="tryEndpoint('/health')" class="w-full text-left p-4 card group">
              <div class="flex items-center justify-between mb-1">
                <div class="font-mono text-sm"><span class="text-emerald-600">GET</span> <span class="text-gray-900 font-semibold">/health</span></div>
                <svg class="w-4 h-4 text-gray-300 group-hover:text-orange-500 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
              </div>
              <p class="text-xs text-gray-400">Check server status</p>
            </button>
          </div>
        </div>
        <div>
          <h3 class="text-sm font-bold text-orange-600 uppercase tracking-wider mb-4 flex items-center gap-2">
            <div class="w-2 h-2 rounded-full bg-orange-500"></div> Paid Endpoints (x402)
          </h3>
          <div class="space-y-3">
            <button onclick="tryEndpoint('/feeds/whale-alerts')" class="w-full text-left p-4 card group">
              <div class="flex items-center justify-between mb-1">
                <div class="font-mono text-sm"><span class="text-emerald-600">GET</span> <span class="text-gray-900 font-semibold">/feeds/whale-alerts</span></div>
                <span class="text-xs font-bold text-orange-600 bg-orange-50 px-2.5 py-1 rounded-full">0.005 STX</span>
              </div>
              <p class="text-xs text-gray-400">Whale movements — returns 402 Payment Required</p>
            </button>
            <button onclick="tryEndpoint('/feeds/btc-sentiment')" class="w-full text-left p-4 card group">
              <div class="flex items-center justify-between mb-1">
                <div class="font-mono text-sm"><span class="text-emerald-600">GET</span> <span class="text-gray-900 font-semibold">/feeds/btc-sentiment</span></div>
                <span class="text-xs font-bold text-orange-600 bg-orange-50 px-2.5 py-1 rounded-full">0.003 STX</span>
              </div>
              <p class="text-xs text-gray-400">BTC sentiment — returns 402 Payment Required</p>
            </button>
            <button onclick="tryEndpoint('/feeds/defi-scores')" class="w-full text-left p-4 card group">
              <div class="flex items-center justify-between mb-1">
                <div class="font-mono text-sm"><span class="text-emerald-600">GET</span> <span class="text-gray-900 font-semibold">/feeds/defi-scores</span></div>
                <span class="text-xs font-bold text-orange-600 bg-orange-50 px-2.5 py-1 rounded-full">0.01 STX</span>
              </div>
              <p class="text-xs text-gray-400">DeFi scores — returns 402 Payment Required</p>
            </button>
          </div>
        </div>
      </div>

      <!-- Response Panel -->
      <div id="response-panel" class="mt-8 hidden">
        <div class="rounded-2xl bg-gray-900 overflow-hidden shadow-2xl">
          <div class="flex items-center justify-between px-5 py-3 bg-gray-800 border-b border-gray-700">
            <div class="flex items-center gap-3">
              <div class="flex gap-1.5">
                <div class="w-3 h-3 rounded-full bg-red-500/80"></div>
                <div class="w-3 h-3 rounded-full bg-yellow-500/80"></div>
                <div class="w-3 h-3 rounded-full bg-green-500/80"></div>
              </div>
              <span id="response-method" class="text-sm font-mono font-bold text-emerald-400">GET</span>
              <span id="response-url" class="text-sm font-mono text-gray-400">/health</span>
            </div>
            <div class="flex items-center gap-3">
              <span id="response-status" class="text-xs font-bold px-2.5 py-1 rounded-full">200</span>
              <span id="response-time" class="text-xs text-gray-500">0ms</span>
            </div>
          </div>
          <div class="p-5 max-h-96 overflow-auto">
            <pre id="response-body" class="text-sm font-mono text-gray-300 whitespace-pre-wrap"></pre>
          </div>
          <div id="payment-explainer" class="hidden px-5 py-4 bg-orange-500/10 border-t border-orange-500/20">
            <div class="flex items-start gap-3">
              <div class="w-8 h-8 rounded-lg bg-orange-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                <svg class="w-5 h-5 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <div>
                <p class="text-sm font-semibold text-orange-400 mb-1">HTTP 402 — Payment Required</p>
                <p class="text-xs text-gray-400">This is the x402 protocol response. AI agents automatically read the payment requirements, sign an STX transaction, and resend the request. Data is delivered after on-chain verification.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="section-divider"></div>

  <!-- Provider Stats -->
  <section id="stats" class="py-24 px-6 bg-gray-50/50">
    <div class="max-w-5xl mx-auto">
      <div class="text-center mb-16 reveal">
        <p class="text-sm font-semibold text-orange-500 uppercase tracking-widest mb-3">Analytics</p>
        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">Provider Stats</h2>
      </div>
      <div class="grid md:grid-cols-4 gap-4 mb-10 reveal">
        <div class="stat-card p-6 text-center">
          <div class="text-3xl font-black text-gray-900 mb-1" id="stat-queries">-</div>
          <div class="text-sm text-gray-400">Total Queries</div>
        </div>
        <div class="stat-card p-6 text-center">
          <div class="text-3xl font-black text-gray-900 mb-1" id="stat-reputation">-</div>
          <div class="text-sm text-gray-400">Reputation Score</div>
        </div>
        <div class="stat-card p-6 text-center">
          <div class="text-3xl font-black text-gray-900 mb-1" id="stat-tier">-</div>
          <div class="text-sm text-gray-400">Provider Tier</div>
        </div>
        <div class="stat-card p-6 text-center">
          <div class="text-3xl font-black text-gray-900 mb-1" id="stat-uptime">-</div>
          <div class="text-sm text-gray-400">Uptime</div>
        </div>
      </div>
      <div class="card overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-100">
          <h3 class="font-bold text-gray-900">Feed Performance</h3>
        </div>
        <div class="divide-y divide-gray-100" id="feed-breakdown"></div>
      </div>
    </div>
  </section>

  <div class="section-divider"></div>

  <!-- Activity -->
  <section id="activity" class="py-24 px-6">
    <div class="max-w-5xl mx-auto">
      <div class="flex items-center justify-between mb-10 reveal">
        <div>
          <p class="text-sm font-semibold text-orange-500 uppercase tracking-widest mb-2">Real-Time</p>
          <h2 class="text-4xl font-extrabold text-gray-900 mb-2">Live Activity</h2>
          <p class="text-gray-400">Every row is a real micropayment from an AI agent.</p>
        </div>
        <div class="flex items-center gap-6">
          <div class="text-right">
            <div class="text-2xl font-black text-orange-500" id="activity-revenue">0</div>
            <div class="text-xs text-gray-400">Total Revenue (STX)</div>
          </div>
          <div class="text-right">
            <div class="text-2xl font-black text-gray-900" id="activity-agents">0</div>
            <div class="text-xs text-gray-400">Unique Agents</div>
          </div>
        </div>
      </div>

      <div class="card overflow-hidden">
        <div class="px-6 py-3 bg-gray-50 border-b border-gray-100 flex items-center justify-between">
          <div class="flex items-center gap-2">
            <div class="w-2 h-2 rounded-full bg-emerald-500 pulse-dot"></div>
            <span class="text-sm font-semibold text-gray-600">Recent Transactions</span>
          </div>
          <button onclick="loadActivity()" class="text-xs text-gray-400 hover:text-orange-500 transition flex items-center gap-1 font-medium">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
            Refresh
          </button>
        </div>
        <div class="hidden md:grid grid-cols-12 gap-2 px-6 py-2.5 text-xs font-bold text-gray-400 uppercase tracking-wider border-b border-gray-100 bg-gray-50/50">
          <div class="col-span-1">Time</div>
          <div class="col-span-2">Feed</div>
          <div class="col-span-3">Agent</div>
          <div class="col-span-3">TX Hash</div>
          <div class="col-span-1 text-right">Price</div>
          <div class="col-span-1 text-right">Speed</div>
          <div class="col-span-1 text-right">Status</div>
        </div>
        <div id="activity-rows" class="divide-y divide-gray-50 max-h-[500px] overflow-y-auto">
          <div class="px-6 py-8 text-center text-gray-400 text-sm">Loading activity...</div>
        </div>
      </div>
    </div>
  </section>

  <div class="section-divider"></div>

  <!-- Leaderboard -->
  <section id="leaderboard" class="py-24 px-6 bg-gray-50/50">
    <div class="max-w-5xl mx-auto">
      <div class="text-center mb-10 reveal">
        <p class="text-sm font-semibold text-orange-500 uppercase tracking-widest mb-2">Rankings</p>
        <h2 class="text-4xl font-extrabold text-gray-900 mb-2">Agent Leaderboard</h2>
        <p class="text-gray-400">Top AI agents ranked by total data queries.</p>
      </div>
      <div class="card overflow-hidden">
        <div class="hidden md:grid grid-cols-12 gap-2 px-6 py-3 text-xs font-bold text-gray-400 uppercase tracking-wider border-b border-gray-100 bg-gray-50">
          <div class="col-span-1">#</div>
          <div class="col-span-3">Agent</div>
          <div class="col-span-2 text-center">Total Queries</div>
          <div class="col-span-2 text-center">Spent (STX)</div>
          <div class="col-span-3 text-center">Feed Breakdown</div>
          <div class="col-span-1 text-right">Avg Speed</div>
        </div>
        <div id="leaderboard-rows" class="divide-y divide-gray-50">
          <div class="px-6 py-8 text-center text-gray-400 text-sm">Loading leaderboard...</div>
        </div>
      </div>
    </div>
  </section>

  <div class="section-divider"></div>

  <!-- For Developers -->
  <section class="py-24 px-6">
    <div class="max-w-4xl mx-auto">
      <div class="text-center mb-16 reveal">
        <p class="text-sm font-semibold text-orange-500 uppercase tracking-widest mb-3">Integration</p>
        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">For Developers</h2>
        <p class="text-lg text-gray-400">Integrate your AI agent with ShadowFeed in 4 lines of code.</p>
      </div>
      <div class="rounded-2xl bg-gray-900 overflow-hidden shadow-2xl reveal-scale">
        <div class="flex border-b border-gray-700">
          <button onclick="showTab('install')" id="tab-install" class="px-6 py-3 text-sm font-semibold text-orange-400 border-b-2 border-orange-500 transition">Install</button>
          <button onclick="showTab('server')" id="tab-server" class="px-6 py-3 text-sm font-semibold text-gray-500 hover:text-gray-300 border-b-2 border-transparent transition">Server (Sell Data)</button>
          <button onclick="showTab('client')" id="tab-client" class="px-6 py-3 text-sm font-semibold text-gray-500 hover:text-gray-300 border-b-2 border-transparent transition">Client (Buy Data)</button>
        </div>
        <div id="code-install" class="p-6">
          <pre class="text-sm font-mono text-gray-300 overflow-x-auto"><span class="text-gray-500"># Install x402-stacks SDK</span>
<span class="text-emerald-400">npm</span> install x402-stacks express

<span class="text-gray-500"># Generate testnet wallet</span>
<span class="text-emerald-400">npx</span> tsx -e "const {generateKeypair}=require('x402-stacks'); console.log(generateKeypair('testnet'))"

<span class="text-gray-500"># Fund wallet from faucet</span>
<span class="text-gray-500"># https://explorer.stacks.co/sandbox/faucet?chain=testnet</span></pre>
        </div>
        <div id="code-server" class="p-6 hidden">
          <pre class="text-sm font-mono text-gray-300 overflow-x-auto"><span class="text-gray-500">// Protect endpoint with x402 payment</span>
<span class="text-purple-400">import</span> { paymentMiddleware, STXtoMicroSTX } <span class="text-purple-400">from</span> <span class="text-emerald-400">'x402-stacks'</span>;

app.<span class="text-blue-400">get</span>(<span class="text-emerald-400">'/my-data-feed'</span>,
  <span class="text-blue-400">paymentMiddleware</span>({
    amount: <span class="text-blue-400">STXtoMicroSTX</span>(<span class="text-orange-400">0.005</span>),
    payTo: <span class="text-emerald-400">'ST_YOUR_ADDRESS'</span>,
    network: <span class="text-emerald-400">'testnet'</span>,
    asset: <span class="text-emerald-400">'STX'</span>,
  }),
  (req, res) => {
    res.<span class="text-blue-400">json</span>({ data: <span class="text-emerald-400">'Your premium data here'</span> });
  }
);</pre>
        </div>
        <div id="code-client" class="p-6 hidden">
          <pre class="text-sm font-mono text-gray-300 overflow-x-auto"><span class="text-gray-500">// AI agent auto-pays when accessing data</span>
<span class="text-purple-400">import</span> { wrapAxiosWithPayment, privateKeyToAccount } <span class="text-purple-400">from</span> <span class="text-emerald-400">'x402-stacks'</span>;

<span class="text-purple-400">const</span> account = <span class="text-blue-400">privateKeyToAccount</span>(PRIVATE_KEY, <span class="text-emerald-400">'testnet'</span>);
<span class="text-purple-400">const</span> api = <span class="text-blue-400">wrapAxiosWithPayment</span>(axios.<span class="text-blue-400">create</span>(), account);

<span class="text-gray-500">// Request data — payment is automatic!</span>
<span class="text-purple-400">const</span> { data } = <span class="text-purple-400">await</span> api.<span class="text-blue-400">get</span>(<span class="text-emerald-400">'https://shadowfeed-production.up.railway.app/feeds/whale-alerts'</span>);
console.<span class="text-blue-400">log</span>(data);</pre>
        </div>
      </div>
    </div>
  </section>

  <div class="section-divider"></div>

  <!-- Cost Comparison -->
  <section class="py-24 px-6 bg-gray-50/50">
    <div class="max-w-4xl mx-auto">
      <div class="text-center mb-16 reveal">
        <p class="text-sm font-semibold text-orange-500 uppercase tracking-widest mb-3">Pricing</p>
        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">Cost Comparison</h2>
        <p class="text-lg text-gray-400">Pay-per-query vs monthly subscriptions.</p>
      </div>
      <div class="card overflow-hidden reveal-scale">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-gray-100 text-gray-400 bg-gray-50">
              <th class="text-left px-6 py-4 font-bold">Provider</th>
              <th class="text-left px-6 py-4 font-bold">Model</th>
              <th class="text-left px-6 py-4 font-bold">Price</th>
              <th class="text-left px-6 py-4 font-bold">10 Queries Cost</th>
            </tr>
          </thead>
          <tbody class="text-gray-600">
            <tr class="border-b border-gray-50">
              <td class="px-6 py-4 font-medium text-gray-900">CoinGecko Pro</td>
              <td class="px-6 py-4"><span class="text-red-600 text-xs font-bold bg-red-50 px-2.5 py-1 rounded-full">Subscription</span></td>
              <td class="px-6 py-4">$129/mo</td>
              <td class="px-6 py-4 text-red-600 font-bold">$129.00</td>
            </tr>
            <tr class="border-b border-gray-50">
              <td class="px-6 py-4 font-medium text-gray-900">Nansen</td>
              <td class="px-6 py-4"><span class="text-red-600 text-xs font-bold bg-red-50 px-2.5 py-1 rounded-full">Subscription</span></td>
              <td class="px-6 py-4">$150/mo</td>
              <td class="px-6 py-4 text-red-600 font-bold">$150.00</td>
            </tr>
            <tr class="border-b border-gray-50">
              <td class="px-6 py-4 font-medium text-gray-900">Arkham Intel</td>
              <td class="px-6 py-4"><span class="text-red-600 text-xs font-bold bg-red-50 px-2.5 py-1 rounded-full">Subscription</span></td>
              <td class="px-6 py-4">$300/mo</td>
              <td class="px-6 py-4 text-red-600 font-bold">$300.00</td>
            </tr>
            <tr class="bg-orange-50/50">
              <td class="px-6 py-4 font-bold text-gray-900">ShadowFeed</td>
              <td class="px-6 py-4"><span class="text-orange-600 text-xs font-bold bg-orange-100 px-2.5 py-1 rounded-full">Pay-Per-Query</span></td>
              <td class="px-6 py-4 text-orange-600 font-semibold">~$0.003-0.01/query</td>
              <td class="px-6 py-4 text-orange-600 font-black text-lg">~$0.06</td>
            </tr>
          </tbody>
        </table>
      </div>
      <p class="text-center text-sm text-gray-400 mt-4">* Prices based on STX ~ $1.00. Actual costs vary with STX price.</p>
    </div>
  </section>

  <!-- Data Detail Modal -->
  <div id="data-modal" class="fixed inset-0 z-[100] hidden">
    <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" onclick="closeDataModal()"></div>
    <div class="absolute inset-4 md:inset-y-8 md:inset-x-[15%] bg-white border border-gray-200 rounded-2xl overflow-hidden flex flex-col shadow-2xl">
      <div class="flex items-center justify-between px-6 py-4 bg-gray-50 border-b border-gray-100">
        <div class="flex items-center gap-4">
          <span id="modal-feed-badge" class="px-3 py-1 rounded-full text-xs font-bold"></span>
          <div>
            <span id="modal-title" class="text-gray-900 font-bold text-sm"></span>
            <span id="modal-time" class="text-gray-400 text-xs ml-3"></span>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <span id="modal-source-badge" class="text-xs px-2 py-1 rounded-full"></span>
          <button onclick="closeDataModal()" class="w-8 h-8 rounded-lg bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-400 hover:text-gray-600 transition">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
          </button>
        </div>
      </div>
      <div class="px-6 py-3 bg-gray-50/50 border-b border-gray-100 flex items-center gap-6 text-xs">
        <div class="flex items-center gap-2"><span class="text-gray-400">Agent:</span><span id="modal-agent" class="text-gray-700 font-mono"></span></div>
        <div class="flex items-center gap-2"><span class="text-gray-400">TX:</span><span id="modal-tx" class="text-orange-600 font-mono"></span></div>
        <div class="flex items-center gap-2"><span class="text-gray-400">Price:</span><span id="modal-price" class="text-orange-600 font-bold"></span></div>
        <div class="flex items-center gap-2"><span class="text-gray-400">Speed:</span><span id="modal-speed" class="text-gray-700"></span></div>
      </div>
      <div class="flex-1 overflow-hidden flex flex-col md:flex-row">
        <div id="modal-visual" class="md:w-1/2 p-6 overflow-y-auto border-r border-gray-100">
          <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4">Data Summary</h3>
          <div id="modal-visual-content"></div>
        </div>
        <div class="md:w-1/2 p-6 overflow-y-auto bg-gray-50/50">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider">Raw Response</h3>
            <button onclick="copyJson()" class="text-xs text-gray-400 hover:text-orange-500 transition flex items-center gap-1 font-medium">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/></svg>
              Copy JSON
            </button>
          </div>
          <pre id="modal-json" class="text-xs font-mono text-gray-600 whitespace-pre-wrap bg-white p-4 rounded-xl border border-gray-200 max-h-[60vh] overflow-auto"></pre>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="py-12 px-6 border-t border-gray-100 bg-white">
    <div class="max-w-5xl mx-auto">
      <div class="flex flex-col md:flex-row items-center justify-between gap-6">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-orange-500 to-amber-500 flex items-center justify-center shadow-lg shadow-orange-500/20">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
          </div>
          <span class="font-extrabold text-gray-900">Shadow<span class="text-orange-500">Feed</span></span>
        </div>
        <div class="flex items-center gap-6 text-sm text-gray-400">
          <span>Built on <a href="https://www.stacks.co" target="_blank" class="text-gray-600 hover:text-gray-900 transition font-medium">Stacks</a></span>
          <span>Powered by <a href="https://www.stacksx402.com" target="_blank" class="text-gray-600 hover:text-gray-900 transition font-medium">x402</a></span>
          <span>Settled on <span class="text-orange-500 font-semibold">Bitcoin</span></span>
        </div>
        <div class="text-sm text-gray-300" id="footer-provider"></div>
      </div>
    </div>
  </footer>

  <script>
    const API = window.location.origin;

    function showTab(tab) {
      ['install', 'server', 'client'].forEach(t => {
        document.getElementById('code-' + t).classList.toggle('hidden', t !== tab);
        const btn = document.getElementById('tab-' + t);
        btn.classList.toggle('text-orange-400', t === tab);
        btn.classList.toggle('border-orange-500', t === tab);
        btn.classList.toggle('text-gray-500', t !== tab);
        btn.classList.toggle('border-transparent', t !== tab);
      });
    }

    async function tryEndpoint(path) {
      const panel = document.getElementById('response-panel');
      const body = document.getElementById('response-body');
      const status = document.getElementById('response-status');
      const url = document.getElementById('response-url');
      const time = document.getElementById('response-time');
      const explainer = document.getElementById('payment-explainer');

      panel.classList.remove('hidden');
      panel.classList.add('fade-in');
      url.textContent = path;
      body.textContent = 'Loading...';
      status.textContent = '...';
      status.className = 'text-xs font-bold px-2.5 py-1 rounded-full bg-gray-700 text-gray-300';
      explainer.classList.add('hidden');

      const start = performance.now();
      try {
        const res = await fetch(API + path);
        const elapsed = Math.round(performance.now() - start);
        time.textContent = elapsed + 'ms';

        let data;
        const contentType = res.headers.get('content-type') || '';
        if (contentType.includes('json')) {
          data = await res.json();
          body.textContent = JSON.stringify(data, null, 2);
        } else {
          data = await res.text();
          try { body.textContent = JSON.stringify(JSON.parse(data), null, 2); } catch { body.textContent = data; }
        }

        status.textContent = res.status;
        if (res.status === 200) {
          status.className = 'text-xs font-bold px-2.5 py-1 rounded-full bg-emerald-500/20 text-emerald-400';
        } else if (res.status === 402) {
          status.className = 'text-xs font-bold px-2.5 py-1 rounded-full bg-orange-500/20 text-orange-400';
          explainer.classList.remove('hidden');
          const paymentHeader = res.headers.get('payment-required');
          if (paymentHeader) { try { body.textContent = JSON.stringify(JSON.parse(atob(paymentHeader)), null, 2); } catch {} }
        } else {
          status.className = 'text-xs font-bold px-2.5 py-1 rounded-full bg-red-500/20 text-red-400';
        }
      } catch (err) {
        body.textContent = 'Error: ' + err.message;
        status.textContent = 'ERR';
        status.className = 'text-xs font-bold px-2.5 py-1 rounded-full bg-red-500/20 text-red-400';
        time.textContent = '-';
      }
      panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    const feedIcons = {
      'whale-alerts': { icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>', color: 'blue' },
      'btc-sentiment': { icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>', color: 'purple' },
      'defi-scores': { icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>', color: 'emerald' },
    };

    async function loadFeeds() {
      try {
        const res = await fetch(API + '/registry/feeds');
        const data = await res.json();
        const grid = document.getElementById('feeds-grid');
        grid.innerHTML = data.feeds.map(feed => {
          const fi = feedIcons[feed.id] || feedIcons['whale-alerts'];
          return `
            <div class="card p-8" id="feed-card-${feed.id}">
              <div class="flex items-center justify-between mb-5">
                <div class="w-14 h-14 rounded-2xl bg-${fi.color}-50 flex items-center justify-center">
                  <svg class="w-7 h-7 text-${fi.color}-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">${fi.icon}</svg>
                </div>
                <span class="text-2xl font-black text-orange-500">${feed.price_display}</span>
              </div>
              <h3 class="text-lg font-bold text-gray-900 mb-2">${feed.id.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')}</h3>
              <p class="text-sm text-gray-500 mb-5 leading-relaxed">${feed.description}</p>
              <div class="flex items-center justify-between text-xs text-gray-400">
                <span class="px-2.5 py-1 bg-gray-100 rounded-full font-medium">${feed.category}</span>
                <span>${feed.update_frequency}</span>
              </div>
              <div class="mt-5 pt-5 border-t border-gray-100 flex items-center justify-between text-xs text-gray-400">
                <span>${feed.stats.total_queries} queries served</span>
                <span>${feed.stats.avg_response_ms}ms avg</span>
              </div>
              <button onclick="buyFeedData('${feed.id}', ${feed.price_microstx})"
                class="wallet-buy-btn hidden w-full mt-4 py-3 rounded-xl bg-gray-900 hover:bg-gray-800 text-white text-sm font-bold transition shadow-lg flex items-center justify-center gap-2"
                id="buy-btn-${feed.id}">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                Buy Data — ${feed.price_display}
              </button>
            </div>`;
        }).join('');
        document.getElementById('hero-feeds').textContent = data.feeds.length;
        document.getElementById('footer-provider').textContent = data.provider.slice(0, 10) + '...' + data.provider.slice(-6);
      } catch {}
    }

    async function loadStats() {
      try {
        const res = await fetch(API + '/stats');
        const data = await res.json();
        document.getElementById('stat-queries').textContent = data.total_queries_served;
        document.getElementById('stat-reputation').textContent = data.reputation_score + '/100';
        document.getElementById('stat-tier').textContent = data.tier.charAt(0).toUpperCase() + data.tier.slice(1);
        document.getElementById('stat-uptime').textContent = data.uptime_percent.toFixed(1) + '%';
        document.getElementById('hero-queries').textContent = data.total_queries_served;
        const breakdown = document.getElementById('feed-breakdown');
        breakdown.innerHTML = data.feed_breakdown.map(f => `
          <div class="px-6 py-4 flex items-center justify-between">
            <span class="text-sm font-semibold text-gray-900">${f.feed_id}</span>
            <div class="flex items-center gap-8 text-sm">
              <div class="text-center"><div class="font-bold text-gray-900">${f.queries}</div><div class="text-xs text-gray-400">Queries</div></div>
              <div class="text-center"><div class="font-bold text-gray-900">${f.avg_response_ms}ms</div><div class="text-xs text-gray-400">Avg Response</div></div>
              <div class="text-center"><div class="font-bold ${f.error_rate === 0 ? 'text-emerald-600' : 'text-red-600'}">${(f.error_rate * 100).toFixed(1)}%</div><div class="text-xs text-gray-400">Error Rate</div></div>
            </div>
          </div>`).join('');
      } catch {}
    }

    const feedMeta = {
      'whale-alerts': { label: 'Whale Alerts', color: 'blue', emoji: '' },
      'btc-sentiment': { label: 'BTC Sentiment', color: 'purple', emoji: '' },
      'defi-scores': { label: 'DeFi Scores', color: 'emerald', emoji: '' },
    };

    async function loadActivity() {
      try {
        const res = await fetch(API + '/activity?limit=50');
        const data = await res.json();
        document.getElementById('activity-revenue').textContent = data.total_revenue_stx.toFixed(3);
        document.getElementById('activity-agents').textContent = data.unique_agents;
        const rows = document.getElementById('activity-rows');
        if (data.activity.length === 0) {
          rows.innerHTML = '<div class="px-6 py-12 text-center text-gray-400 text-sm">No activity yet.</div>';
          return;
        }
        rows.innerHTML = data.activity.map((a, i) => {
          const meta = feedMeta[a.feed] || { label: a.feed, color: 'zinc', emoji: '' };
          return `
            <div class="grid grid-cols-12 gap-2 px-6 py-3 text-sm items-center hover:bg-gray-50 transition cursor-pointer ${i % 2 === 1 ? 'bg-gray-50/50' : ''}" onclick="viewQueryData(${a.id})">
              <div class="col-span-1 text-xs text-gray-400 font-mono">${a.time_ago}</div>
              <div class="col-span-2"><span class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-semibold bg-${meta.color}-50 text-${meta.color}-600">${meta.label}</span></div>
              <div class="col-span-3 text-xs">
                <span class="text-gray-900 font-semibold">${a.agent_name}</span>
                <span class="text-gray-300 font-mono ml-1 text-[10px]">${a.agent_short}</span>
              </div>
              <div class="col-span-3 font-mono text-xs">
                ${a.is_onchain
                  ? `<a href="${a.tx_explorer}" target="_blank" class="text-orange-600 hover:text-orange-500 transition inline-flex items-center gap-1">
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
                      ${a.tx_hash.slice(0, 10)}...${a.tx_hash.slice(-6)}</a>`
                  : a.is_demo ? '<span class="text-gray-300 italic">simulated</span>' : '<span class="text-gray-200">-</span>'}
              </div>
              <div class="col-span-1 text-right"><span class="text-orange-600 font-semibold text-xs">${a.price_stx} STX</span></div>
              <div class="col-span-1 text-right text-xs text-gray-400">${a.response_ms}ms</div>
              <div class="col-span-1 text-right">
                ${a.is_onchain
                  ? `<span class="inline-flex items-center gap-1 text-xs text-emerald-600 font-semibold">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                      On-chain</span>`
                  : `<span class="inline-flex items-center gap-1 text-xs text-gray-300">Demo</span>`}
              </div>
            </div>`;
        }).join('');
      } catch {}
    }

    async function loadLeaderboard() {
      try {
        const res = await fetch(API + '/leaderboard');
        const data = await res.json();
        const rows = document.getElementById('leaderboard-rows');
        if (data.agents.length === 0) { rows.innerHTML = '<div class="px-6 py-12 text-center text-gray-400 text-sm">No agents yet.</div>'; return; }
        rows.innerHTML = data.agents.map((a, i) => {
          const rankColors = ['text-orange-500', 'text-gray-400', 'text-amber-600'];
          const rankColor = i < 3 ? rankColors[i] : 'text-gray-300';
          const barMax = data.agents[0].total_queries;
          return `
            <div class="grid grid-cols-12 gap-2 px-6 py-4 items-center hover:bg-gray-50 transition ${i % 2 === 1 ? 'bg-gray-50/50' : ''}">
              <div class="col-span-1"><span class="text-lg font-black ${rankColor}">${a.rank}</span></div>
              <div class="col-span-3">
                <div class="text-sm text-gray-900 font-bold">${a.agent_name}</div>
                <div class="text-xs text-gray-300 font-mono mt-0.5">${a.address_short}</div>
              </div>
              <div class="col-span-2 text-center">
                <div class="text-lg font-black text-gray-900">${a.total_queries}</div>
                <div class="w-full bg-gray-100 rounded-full h-1.5 mt-1"><div class="bg-orange-500 h-1.5 rounded-full" style="width: ${(a.total_queries / barMax * 100)}%"></div></div>
              </div>
              <div class="col-span-2 text-center"><span class="text-orange-600 font-bold">${a.total_spent_stx.toFixed(3)}</span></div>
              <div class="col-span-3 flex items-center justify-center gap-2">
                ${a.feeds.whale_alerts > 0 ? `<span class="px-2 py-0.5 rounded-full text-xs font-semibold bg-blue-50 text-blue-600">${a.feeds.whale_alerts}</span>` : ''}
                ${a.feeds.btc_sentiment > 0 ? `<span class="px-2 py-0.5 rounded-full text-xs font-semibold bg-purple-50 text-purple-600">${a.feeds.btc_sentiment}</span>` : ''}
                ${a.feeds.defi_scores > 0 ? `<span class="px-2 py-0.5 rounded-full text-xs font-semibold bg-emerald-50 text-emerald-600">${a.feeds.defi_scores}</span>` : ''}
              </div>
              <div class="col-span-1 text-right text-sm text-gray-400">${a.avg_response_ms}ms</div>
            </div>`;
        }).join('');
      } catch {}
    }

    let currentModalJson = '';
    function closeDataModal() { document.getElementById('data-modal').classList.add('hidden'); }
    function copyJson() {
      navigator.clipboard.writeText(currentModalJson);
      const btn = event.target.closest('button');
      const orig = btn.innerHTML;
      btn.innerHTML = '<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Copied!';
      setTimeout(() => btn.innerHTML = orig, 1500);
    }

    async function viewQueryData(queryId) {
      try {
        const res = await fetch(`${API}/activity/${queryId}/data`);
        if (!res.ok) throw new Error('Query not found');
        const q = await res.json();
        const modal = document.getElementById('data-modal');
        const meta = feedMeta[q.feed] || { label: q.feed, color: 'zinc' };
        document.getElementById('modal-feed-badge').className = `px-3 py-1 rounded-full text-xs font-bold bg-${meta.color}-50 text-${meta.color}-600`;
        document.getElementById('modal-feed-badge').textContent = meta.label;
        document.getElementById('modal-title').textContent = `Query #${q.id}`;
        document.getElementById('modal-time').textContent = new Date(q.timestamp).toLocaleString();
        const srcBadge = document.getElementById('modal-source-badge');
        const dataSource = q.data?.data_source || q.data?.btc_price_usd ? 'Live API Data' : 'Simulated';
        const hasRealData = dataSource.includes('CoinGecko') || dataSource.includes('DeFiLlama') || dataSource.includes('Alternative.me') || dataSource.includes('Blockchain.info') || dataSource === 'Live API Data';
        srcBadge.textContent = q.data?.data_source || (q.data ? 'Data Available' : 'No Data Stored');
        srcBadge.className = `text-xs px-2 py-1 rounded-full ${hasRealData ? 'bg-emerald-50 text-emerald-600' : 'bg-gray-100 text-gray-400'}`;
        document.getElementById('modal-agent').textContent = q.agent || 'unknown';
        const txEl = document.getElementById('modal-tx');
        if (q.is_onchain && q.tx_hash) { txEl.innerHTML = `<a href="https://explorer.hiro.so/txid/${q.tx_hash}?chain=testnet" target="_blank" class="text-orange-600 hover:underline">${q.tx_hash.slice(0,12)}...</a>`; }
        else if (q.is_demo) { txEl.innerHTML = '<span class="text-gray-300 italic">simulated</span>'; }
        else { txEl.textContent = '-'; }
        document.getElementById('modal-price').textContent = q.price_stx + ' STX';
        document.getElementById('modal-speed').textContent = q.response_ms + 'ms';
        currentModalJson = JSON.stringify(q.data, null, 2);
        document.getElementById('modal-json').textContent = currentModalJson || 'No data stored';
        const visual = document.getElementById('modal-visual-content');
        if (!q.data) { visual.innerHTML = '<p class="text-gray-400 text-sm">Data not stored for this query.</p>'; }
        else { visual.innerHTML = renderVisualData(q.feed, q.data); }
        modal.classList.remove('hidden');
      } catch (err) { console.error('Failed to load:', err); }
    }

    function renderVisualData(feed, data) {
      if (feed === 'whale-alerts') return renderWhaleAlerts(data);
      if (feed === 'btc-sentiment') return renderSentiment(data);
      if (feed === 'defi-scores') return renderDeFiScores(data);
      return '<pre class="text-xs text-gray-500">' + JSON.stringify(data, null, 2) + '</pre>';
    }

    function renderWhaleAlerts(data) {
      const alerts = data.alerts || []; const summary = data.summary || {};
      return `<div class="space-y-4">
        ${data.btc_price_usd ? `<div class="flex items-center gap-2 mb-2"><span class="text-gray-400 text-xs">BTC Price:</span><span class="text-gray-900 font-black text-lg">$${data.btc_price_usd.toLocaleString()}</span></div>` : ''}
        <div class="grid grid-cols-3 gap-3 mb-4">
          <div class="p-3 rounded-xl bg-gray-50 border border-gray-100 text-center"><div class="text-xl font-black text-gray-900">${summary.alert_count || alerts.length}</div><div class="text-xs text-gray-400">Alerts</div></div>
          <div class="p-3 rounded-xl bg-gray-50 border border-gray-100 text-center"><div class="text-xl font-black text-orange-500">${(summary.total_volume_btc || 0).toLocaleString()}</div><div class="text-xs text-gray-400">BTC Volume</div></div>
          <div class="p-3 rounded-xl bg-gray-50 border border-gray-100 text-center"><div class="text-sm font-bold text-gray-900">${summary.most_active || 'N/A'}</div><div class="text-xs text-gray-400">Most Active</div></div>
        </div>
        <div class="space-y-2">${alerts.map(a => {
          const sigColor = a.significance === 'extreme' ? 'text-red-600 bg-red-50' : a.significance === 'critical' ? 'text-amber-600 bg-amber-50' : 'text-blue-600 bg-blue-50';
          return `<div class="p-3 rounded-xl bg-gray-50 border border-gray-100">
            <div class="flex items-center justify-between mb-2"><span class="text-xs font-mono px-2 py-0.5 rounded-full ${sigColor} font-bold">${a.significance.toUpperCase()}</span><span class="text-orange-600 font-black">${a.amount_btc} BTC</span></div>
            <div class="text-xs text-gray-500"><span class="text-gray-700">${a.from?.label || 'Unknown'}</span><span class="mx-2">&rarr;</span><span class="text-gray-700">${a.to?.label || 'Unknown'}</span></div>
            <div class="text-xs text-gray-400 mt-1">$${(a.amount_usd || 0).toLocaleString()} | ${a.type.replace(/_/g, ' ')}</div></div>`;
        }).join('')}</div></div>`;
    }

    function renderSentiment(data) {
      const fgValue = data.fear_greed_index || 50;
      const fgColor = fgValue >= 70 ? 'text-emerald-600' : fgValue >= 40 ? 'text-amber-600' : 'text-red-600';
      const fgBg = fgValue >= 70 ? 'bg-emerald-500' : fgValue >= 40 ? 'bg-amber-500' : 'bg-red-500';
      return `<div class="space-y-4">
        ${data.btc_price_usd ? `<div class="flex items-center gap-4 mb-2">
          <div><span class="text-gray-400 text-xs">BTC Price</span><div class="text-gray-900 font-black text-lg">$${data.btc_price_usd.toLocaleString()}</div></div>
          ${data.btc_24h_change !== undefined ? `<div><span class="text-gray-400 text-xs">24h</span><div class="font-black text-lg ${data.btc_24h_change >= 0 ? 'text-emerald-600' : 'text-red-600'}">${data.btc_24h_change >= 0 ? '+' : ''}${data.btc_24h_change}%</div></div>` : ''}</div>` : ''}
        <div class="p-4 rounded-xl bg-gray-50 border border-gray-100 text-center">
          <div class="text-xs text-gray-400 mb-2">Fear & Greed Index</div>
          <div class="text-4xl font-black ${fgColor} mb-2">${fgValue}</div>
          <div class="w-full bg-gray-200 rounded-full h-3 mb-2"><div class="${fgBg} h-3 rounded-full" style="width: ${fgValue}%"></div></div>
          <div class="text-sm font-bold text-gray-900">${(data.overall_label || 'neutral').replace(/_/g, ' ').toUpperCase()}</div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="p-3 rounded-xl bg-gray-50 border border-gray-100 text-center"><div class="text-xs text-gray-400">Market Trend</div><div class="text-sm font-bold ${data.market_trend === 'bullish' ? 'text-emerald-600' : data.market_trend === 'bearish' ? 'text-red-600' : 'text-amber-600'}">${(data.market_trend || 'N/A').toUpperCase()}</div></div>
          <div class="p-3 rounded-xl bg-gray-50 border border-gray-100 text-center"><div class="text-xs text-gray-400">BTC Dominance</div><div class="text-sm font-bold text-gray-900">${data.btc_dominance || 'N/A'}%</div></div>
        </div>
        <div class="space-y-2"><h4 class="text-xs font-bold text-gray-400 uppercase">Source Scores</h4>
          ${['twitter', 'reddit', 'news'].map(s => { const src = data.sources?.[s]; if (!src) return '';
            return `<div class="p-3 rounded-xl bg-gray-50 border border-gray-100 flex items-center justify-between"><span class="text-sm text-gray-700 capitalize font-medium">${s}</span><span class="text-sm font-bold ${src.score > 0 ? 'text-emerald-600' : src.score < 0 ? 'text-red-600' : 'text-gray-400'}">${src.score > 0 ? '+' : ''}${src.score}</span></div>`;
          }).join('')}</div>
        ${data.sources?.news?.headlines ? `<div class="space-y-1"><h4 class="text-xs font-bold text-gray-400 uppercase">Headlines</h4>${data.sources.news.headlines.map(h => `<p class="text-xs text-gray-500 pl-3 border-l-2 border-gray-200">${h}</p>`).join('')}</div>` : ''}
      </div>`;
    }

    function renderDeFiScores(data) {
      const protocols = data.protocols || [];
      return `<div class="space-y-3">${protocols.map(p => {
        const recColor = { strong_buy: 'text-emerald-600 bg-emerald-50', favorable: 'text-green-600 bg-green-50', neutral: 'text-amber-600 bg-amber-50', caution: 'text-orange-600 bg-orange-50', strong_avoid: 'text-red-600 bg-red-50' };
        const rc = recColor[p.recommendation] || 'text-gray-400 bg-gray-50';
        return `<div class="p-3 rounded-xl bg-gray-50 border border-gray-100">
          <div class="flex items-center justify-between mb-2"><div><span class="text-sm font-bold text-gray-900">${p.protocol}</span><span class="text-xs text-gray-400 ml-2">${p.chain}</span></div><span class="text-xs font-mono px-2 py-0.5 rounded-full ${rc} font-bold">${(p.recommendation || '').replace(/_/g, ' ')}</span></div>
          <div class="grid grid-cols-4 gap-2 text-center text-xs">
            <div><div class="font-bold text-gray-900">${p.tvl_usd >= 1e9 ? (p.tvl_usd / 1e9).toFixed(1) + 'B' : p.tvl_usd >= 1e6 ? (p.tvl_usd / 1e6).toFixed(0) + 'M' : p.tvl_usd.toLocaleString()}</div><div class="text-gray-400">TVL</div></div>
            <div><div class="font-bold ${p.tvl_change_24h >= 0 ? 'text-emerald-600' : 'text-red-600'}">${p.tvl_change_24h >= 0 ? '+' : ''}${p.tvl_change_24h}%</div><div class="text-gray-400">24h</div></div>
            <div><div class="font-bold text-orange-600">${p.composite_score}/100</div><div class="text-gray-400">Score</div></div>
            <div><div class="font-bold text-gray-900">${p.metrics?.audit_count || 0}</div><div class="text-gray-400">Audits</div></div>
          </div></div>`;
      }).join('')}</div>`;
    }

    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeDataModal(); });

    // ===== WALLET CONNECT =====
    let walletAddress = null;
    let walletProvider = null;

    function getWalletProvider() {
      if (window.LeatherProvider) return { provider: window.LeatherProvider, name: 'Leather' };
      if (window.StacksProvider) return { provider: window.StacksProvider, name: 'Stacks Wallet' };
      return null;
    }

    async function connectWallet() {
      const btn = document.getElementById('wallet-btn');
      const btnText = document.getElementById('wallet-btn-text');
      if (walletAddress) {
        walletAddress = null; walletProvider = null;
        btnText.textContent = 'Connect Wallet';
        btn.className = 'flex items-center gap-2 px-5 py-2 rounded-xl bg-gray-900 hover:bg-gray-800 text-white text-sm font-semibold transition shadow-lg shadow-gray-900/10';
        document.querySelectorAll('.wallet-buy-btn').forEach(b => b.classList.add('hidden'));
        return;
      }
      const wp = getWalletProvider();
      if (!wp) { showWalletModal(); return; }
      btnText.textContent = 'Connecting...';
      try {
        let addresses;
        if (wp.provider.request) {
          const resp = await wp.provider.request('getAddresses');
          addresses = resp?.result?.addresses || resp?.addresses || [];
        } else if (wp.provider.connect) {
          const resp = await wp.provider.connect();
          addresses = resp?.addresses || [];
        }
        const stxAddr = addresses.find(a => (a.symbol === 'STX' || a.type === 'stacks') && a.address?.startsWith('ST')) || addresses.find(a => a.address?.startsWith('ST')) || addresses[0];
        if (!stxAddr?.address) { btnText.textContent = 'Connect Wallet'; alert('Could not get STX address.'); return; }
        walletAddress = stxAddr.address;
        walletProvider = wp;
        btnText.textContent = walletAddress.slice(0, 6) + '...' + walletAddress.slice(-4);
        btn.className = 'flex items-center gap-2 px-5 py-2 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm font-semibold transition border border-gray-200';
        document.querySelectorAll('.wallet-buy-btn').forEach(b => b.classList.remove('hidden'));
      } catch (err) {
        btnText.textContent = 'Connect Wallet';
        if (!(err.code === 4001 || err.message?.includes('denied') || err.message?.includes('cancel'))) {
          alert('Wallet connection failed: ' + (err.message || 'Unknown error'));
        }
      }
    }

    function showWalletModal() {
      const modal = document.createElement('div');
      modal.id = 'wallet-install-modal';
      modal.className = 'fixed inset-0 z-[200] flex items-center justify-center';
      modal.innerHTML = `
        <div class="absolute inset-0 bg-black/30 backdrop-blur-sm" onclick="this.parentElement.remove()"></div>
        <div class="relative bg-white border border-gray-200 rounded-2xl p-8 max-w-md mx-4 slide-up shadow-2xl">
          <h3 class="text-xl font-extrabold text-gray-900 mb-2">Wallet Required</h3>
          <p class="text-sm text-gray-500 mb-6">Install a Stacks wallet to buy data from the dashboard.</p>
          <div class="space-y-3">
            <a href="https://leather.io/install-extension" target="_blank" class="flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 hover:border-orange-300 transition group">
              <div class="w-10 h-10 rounded-xl bg-orange-50 flex items-center justify-center text-xl font-black text-orange-500">L</div>
              <div class="flex-1"><div class="text-sm font-bold text-gray-900 group-hover:text-orange-600 transition">Leather Wallet</div><div class="text-xs text-gray-400">Recommended for Stacks</div></div>
              <svg class="w-4 h-4 text-gray-300 group-hover:text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
            </a>
            <a href="https://www.xverse.app/download" target="_blank" class="flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 hover:border-purple-300 transition group">
              <div class="w-10 h-10 rounded-xl bg-purple-50 flex items-center justify-center text-xl font-black text-purple-500">X</div>
              <div class="flex-1"><div class="text-sm font-bold text-gray-900 group-hover:text-purple-600 transition">Xverse Wallet</div><div class="text-xs text-gray-400">Bitcoin + Stacks wallet</div></div>
              <svg class="w-4 h-4 text-gray-300 group-hover:text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
            </a>
          </div>
          <button onclick="this.parentElement.parentElement.remove()" class="mt-6 w-full py-2.5 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-500 text-sm font-medium transition">Cancel</button>
        </div>`;
      document.body.appendChild(modal);
    }

    const feedPricesMap = { 'whale-alerts': { micro: 5000, stx: 0.005 }, 'btc-sentiment': { micro: 3000, stx: 0.003 }, 'defi-scores': { micro: 10000, stx: 0.01 } };

    async function buyFeedData(feedId, priceMicro) {
      if (!walletAddress || !walletProvider) { alert('Please connect your wallet first.'); return; }
      const btn = document.getElementById('buy-btn-' + feedId);
      const origText = btn.innerHTML;
      btn.innerHTML = '<svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg> Sending...';
      btn.disabled = true;
      try {
        const healthRes = await fetch(API + '/health');
        const health = await healthRes.json();
        const recipient = health.provider;
        const price = feedPricesMap[feedId] || { micro: priceMicro, stx: priceMicro / 1000000 };
        let txId;
        if (walletProvider.provider.request) {
          const resp = await walletProvider.provider.request('stx_transferStx', { recipient, amount: String(price.micro), network: 'testnet', memo: 'ShadowFeed: ' + feedId });
          txId = resp?.result?.txid || resp?.result?.txId || resp?.txid;
        } else { throw new Error('Wallet API not supported'); }
        if (!txId) throw new Error('No txId returned');
        btn.innerHTML = '<svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg> Fetching data...';
        const buyRes = await fetch(API + '/wallet/buy', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ feedId, txId, senderAddress: walletAddress }) });
        if (!buyRes.ok) { const errData = await buyRes.json(); throw new Error(errData.error || 'Server error'); }
        const result = await buyRes.json();
        showWalletPurchaseResult(feedId, result, txId);
        loadActivity(); loadStats(); loadLeaderboard();
      } catch (err) {
        if (!(err.code === 4001 || err.message?.includes('denied') || err.message?.includes('cancel'))) { alert('Purchase failed: ' + (err.message || 'Unknown error')); }
      } finally { btn.innerHTML = origText; btn.disabled = false; }
    }

    function showWalletPurchaseResult(feedId, result, txId) {
      const meta = feedMeta[feedId] || { label: feedId, color: 'zinc' };
      const modal = document.createElement('div');
      modal.id = 'purchase-result-modal';
      modal.className = 'fixed inset-0 z-[200]';
      modal.innerHTML = `
        <div class="absolute inset-0 bg-black/30 backdrop-blur-sm" onclick="this.parentElement.remove()"></div>
        <div class="absolute inset-4 md:inset-y-8 md:inset-x-[15%] bg-white border border-gray-200 rounded-2xl overflow-hidden flex flex-col slide-up shadow-2xl">
          <div class="flex items-center justify-between px-6 py-4 bg-emerald-50 border-b border-emerald-100">
            <div class="flex items-center gap-4">
              <div class="w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center"><svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg></div>
              <div><span class="text-gray-900 font-bold text-sm">Purchase Successful!</span><span class="text-gray-400 text-xs ml-3">${meta.label}</span></div>
            </div>
            <button onclick="this.closest('#purchase-result-modal').remove()" class="w-8 h-8 rounded-lg bg-white/80 hover:bg-white flex items-center justify-center text-gray-400 hover:text-gray-600 transition">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
          </div>
          <div class="px-6 py-3 bg-gray-50 border-b border-gray-100 flex items-center gap-6 text-xs">
            <div class="flex items-center gap-2"><span class="text-gray-400">Paid:</span><span class="text-orange-600 font-bold">${result.price}</span></div>
            <div class="flex items-center gap-2"><span class="text-gray-400">TX:</span><a href="${result.tx_explorer}" target="_blank" class="text-orange-600 hover:underline font-mono">${txId.slice(0,12)}...</a></div>
            <div class="flex items-center gap-2"><span class="text-gray-400">From:</span><span class="text-gray-600 font-mono">${walletAddress.slice(0,8)}...${walletAddress.slice(-4)}</span></div>
          </div>
          <div class="flex-1 overflow-hidden flex flex-col md:flex-row">
            <div class="md:w-1/2 p-6 overflow-y-auto border-r border-gray-100"><h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4">Data Summary</h3><div>${renderVisualData(feedId, result.data)}</div></div>
            <div class="md:w-1/2 p-6 overflow-y-auto bg-gray-50/50">
              <div class="flex items-center justify-between mb-4"><h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider">Raw Response</h3><button id="purchase-copy-btn" class="text-xs text-gray-400 hover:text-orange-500 transition font-medium">Copy JSON</button></div>
              <pre id="purchase-json" class="text-xs font-mono text-gray-600 whitespace-pre-wrap bg-white p-4 rounded-xl border border-gray-200 max-h-[60vh] overflow-auto"></pre>
            </div>
          </div>
        </div>`;
      document.body.appendChild(modal);
      const jsonStr = JSON.stringify(result.data, null, 2);
      document.getElementById('purchase-json').textContent = jsonStr;
      document.getElementById('purchase-copy-btn').onclick = () => {
        navigator.clipboard.writeText(jsonStr);
        document.getElementById('purchase-copy-btn').textContent = 'Copied!';
        setTimeout(() => document.getElementById('purchase-copy-btn').textContent = 'Copy JSON', 1500);
      };
      const handler = (e) => { if (e.key === 'Escape') { modal.remove(); document.removeEventListener('keydown', handler); } };
      document.addEventListener('keydown', handler);
    }

    loadFeeds(); loadStats(); loadActivity(); loadLeaderboard();
    setInterval(() => { loadStats(); loadActivity(); loadLeaderboard(); }, 5000);

    // ===== SCROLL REVEAL OBSERVER =====
    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });

    document.querySelectorAll('.reveal, .reveal-left, .reveal-right, .reveal-scale').forEach(el => {
      revealObserver.observe(el);
    });

    // ===== SMOOTH NAV SCROLL EFFECT =====
    const nav = document.querySelector('nav');
    window.addEventListener('scroll', () => {
      nav.classList.toggle('scrolled', window.scrollY > 20);
    }, { passive: true });

    // ===== 3D PARTICLE SYSTEM =====
    (function() {
      const canvas = document.getElementById('particle-canvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      let width, height, particles, mouse, animId;
      const PARTICLE_COUNT = 80;
      const CONNECTION_DIST = 150;
      const MOUSE_RADIUS = 200;

      mouse = { x: -999, y: -999 };

      function resize() {
        const hero = document.getElementById('hero');
        if (!hero) return;
        width = canvas.width = hero.offsetWidth;
        height = canvas.height = hero.offsetHeight;
      }

      function createParticle() {
        return {
          x: Math.random() * width,
          y: Math.random() * height,
          z: Math.random() * 200 + 50,
          vx: (Math.random() - 0.5) * 0.4,
          vy: (Math.random() - 0.5) * 0.4,
          vz: (Math.random() - 0.5) * 0.15,
          baseSize: Math.random() * 2 + 1,
        };
      }

      function init() {
        resize();
        particles = [];
        for (let i = 0; i < PARTICLE_COUNT; i++) {
          particles.push(createParticle());
        }
      }

      function project(p) {
        const perspective = 600;
        const scale = perspective / (perspective + p.z);
        return {
          x: (p.x - width / 2) * scale + width / 2,
          y: (p.y - height / 2) * scale + height / 2,
          size: p.baseSize * scale,
          alpha: Math.max(0.15, Math.min(0.7, scale)),
          scale: scale
        };
      }

      function draw() {
        ctx.clearRect(0, 0, width, height);

        // Update particles
        for (let i = 0; i < particles.length; i++) {
          const p = particles[i];
          p.x += p.vx;
          p.y += p.vy;
          p.z += p.vz;

          // Mouse repulsion
          const proj = project(p);
          const dx = proj.x - mouse.x;
          const dy = proj.y - mouse.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < MOUSE_RADIUS && dist > 0) {
            const force = (MOUSE_RADIUS - dist) / MOUSE_RADIUS * 0.02;
            p.vx += dx / dist * force;
            p.vy += dy / dist * force;
          }

          // Dampen velocity
          p.vx *= 0.998;
          p.vy *= 0.998;
          p.vz *= 0.998;

          // Wrap around
          if (p.x < -50) p.x = width + 50;
          if (p.x > width + 50) p.x = -50;
          if (p.y < -50) p.y = height + 50;
          if (p.y > height + 50) p.y = -50;
          if (p.z < 10) p.z = 250;
          if (p.z > 250) p.z = 10;
        }

        // Sort by z for proper depth rendering
        const sorted = particles.map((p, i) => ({ ...p, idx: i, proj: project(p) }));
        sorted.sort((a, b) => b.z - a.z);

        // Draw connections
        for (let i = 0; i < sorted.length; i++) {
          for (let j = i + 1; j < sorted.length; j++) {
            const a = sorted[i].proj;
            const b = sorted[j].proj;
            const dx = a.x - b.x;
            const dy = a.y - b.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < CONNECTION_DIST) {
              const alpha = (1 - dist / CONNECTION_DIST) * 0.12 * Math.min(a.alpha, b.alpha);
              ctx.beginPath();
              ctx.moveTo(a.x, a.y);
              ctx.lineTo(b.x, b.y);
              ctx.strokeStyle = `rgba(247, 147, 26, ${alpha})`;
              ctx.lineWidth = 0.6;
              ctx.stroke();
            }
          }
        }

        // Draw particles
        for (let i = 0; i < sorted.length; i++) {
          const p = sorted[i];
          const pr = p.proj;

          // Outer glow
          ctx.beginPath();
          ctx.arc(pr.x, pr.y, pr.size * 3, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(247, 147, 26, ${pr.alpha * 0.08})`;
          ctx.fill();

          // Core
          ctx.beginPath();
          ctx.arc(pr.x, pr.y, pr.size, 0, Math.PI * 2);
          const gradient = ctx.createRadialGradient(pr.x, pr.y, 0, pr.x, pr.y, pr.size);
          gradient.addColorStop(0, `rgba(247, 147, 26, ${pr.alpha * 0.9})`);
          gradient.addColorStop(0.5, `rgba(234, 88, 12, ${pr.alpha * 0.5})`);
          gradient.addColorStop(1, `rgba(247, 147, 26, 0)`);
          ctx.fillStyle = gradient;
          ctx.fill();
        }

        animId = requestAnimationFrame(draw);
      }

      // Mouse tracking on hero
      const heroSection = document.getElementById('hero');
      heroSection.addEventListener('mousemove', (e) => {
        const rect = heroSection.getBoundingClientRect();
        mouse.x = e.clientX - rect.left;
        mouse.y = e.clientY - rect.top;
      }, { passive: true });
      heroSection.addEventListener('mouseleave', () => {
        mouse.x = -999;
        mouse.y = -999;
      }, { passive: true });

      window.addEventListener('resize', () => {
        resize();
      }, { passive: true });

      init();
      draw();

      // Pause when not visible
      const particleObserver = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting) {
          if (!animId) draw();
        } else {
          cancelAnimationFrame(animId);
          animId = null;
        }
      }, { threshold: 0.05 });
      particleObserver.observe(heroSection);
    })();
  </script>
</body>
</html>
